# spring-knowledgeIn-21st
ceos back-end 21st naver knowledge-in clone coding project

---
## Doker 개념
https://www.youtube.com/watch?v=e0koWWAmXSk

예전에 수업에서 도커 관련해서 진도를 조금 나갔을 때 하나도 이해가 안됐어서 다시 찾아봤는데, 
위의 영상이 도커 개념에 대해 쉽게 설명해둔 것 같다..

내 프로젝트에 필요한 라이브러리,OS 등등 모든것을 밀키트처럼 모아서 '이미지'라는 개념으로 만들고
해당 이미지를 실행시키기만 하면 어디서든 내 컴퓨터에서 실행시키는 환경과 똑같은 환경에서 실행되는 느낌?인것같다


## 트러블 슈팅
### 1. 컨테이너 내에서의 localhost ≠ 내 컴퓨터
맨 처음에 db까지 도커로 띄우지는 않고, 스프링만 띄워보기로 했다.
jar 파일로 빌드하고 이미지를 실행시키려 하니 DB 연결 관련 에러가 떴다.
스프링부트 어플리케이션을 실행하면 잘 되는데 왜 그럴까 했더니 데이터베이스 url이 localhost로
되어있어서 그랬다.

도커 컨테이너가 내 컴퓨터(호스트)안에 새로운 미니 컴퓨터를 만든 것이라고 생각해보면 컨테이너 내에서는
localhost가 내 컴퓨터를 가리키지 않을 것이다.
그래서 내가 원하는 localhost를 사용하려면, 도커 컨테이너가 만들어진 진짜 호스트 컴퓨터를 가리키도록 해야한다.

이 문제는 `localhost` 부분을 `host.docker.internal`로 바꾸면 해결이 가능했다. 윈도우에서는 가능하다고 하는데 맥은 잘 모르겠다.


### 2. 컨테이너 이름
두번째로 이제 db도 도커 컨테이너로 만들어서 연결해보았다.
그러면 db url이 `jdbc:mysql://{도커 db 컨테이너 이름}:3306/knowledgeIn` 와 같은 형태를 띌 것이다.

이때 또 멍청비용을 치렀는데.. db의 컨테이너 이름을 안정해준걸 모르고 그냥 db:3306이라고 했다가 계속 연결 에러가 났다.
컨테이너 이름이 db라고 확신하고 있었어서 계속 다른 곳에서 삽질하다가 나중에 알았다..

컨테이너 이름을 안정해주면 기본 이름은 <프로젝트명>_<서비스명>_<순번> 형식으로 지정된다.
docker-compose.yml이 abc라는 디렉터리 아래 있고, 서비스명을 db로 설정했다면 abc-db-1 이런식.

참고로 `docker ps` 라는 명령어를 사용하면 현재 실행중인 도커 컨테이너들의 이름을 포함한 다양한 정보를 알 수 있다.

---
## 추가 구현

### reaction 관련 기능 구현
- 좋아요, 싫어요 입력 받을 수 있음

#### 로직
- 반응 한 적 없을 경우: 요청 들어온 리액션으로 리액션 객체 생성 and 저장
- 현재 저장된 값과 다른 반응 요청: 요청 들어온 리액션 타입으로 변경
- 현재 저장된 값과 동일한 반응 다시 요청: softDelete

### 리팩토링
postService에서 질문 목록 조회 시 답변까지 조회되는 문제 해결
