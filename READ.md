## 🥲수동 배포 하면서 생긴 문제들
~~시작하기 앞서.. 저는 다른 프로젝트를 배포했기에.. 여기에 없습니다..~~

### 배포 하려고 하는데 저장소가 없다고 떠요 ㅠ

- `no space left on device`
- 더 이상 올릴 수 있는 저장소가 없다고 하네요
- 다시 내리고 다 삭제하고 올려도 너무 큰 것 같아요 (저는 스터디 내용이 아닌 다른 내용을 올렸어요!, 근데 사이즈는 비슷한 내용입니다.)
- 사용한 방법 → **직접 rds를 연결해서 사용하자!**
    - mysql 다운 하면서 어쩌구 저쩌구 하면서 용량이 벗어난 것 같아요 (근디 전 살면서 용량을 벗어난 저근 거의 없는 것 같은디.. 머지)
    - 근디 이거 하면서도 나중에 문제 터짐 ㅇㅅㅇ ;;

### Docker Build 명령어 오류

`ERROR: "docker buildx build" requires exactly 1 argument.`

- 음? buildx 뭔소리야? argument가 하나만 필요하다고? 무슨 소리지?
- 영상에서 서지가 말했듯! docker build -t {본인 아이디}/{docker 이미지 이름} .
- 점을 붙여야 현재 디렉토리 기준으로 생성됩니다.

### SSH 키 권한 오류

- 일단 저는 다운로드가 D에 있어서 D로 연결하고 싶었는데.. 너무 권한이 열려있어서 접근 deny
- 그래서 이거를 C 드라이브에 놓아서 User에서 다 관리해야지 ~ 싶었는데 파일 변동이 안됨..
    - 작업 관리자 방법으로 방화벽 꺼서 하는 방법도 있을 것 같은데.. 굳이??
- 이럴 때는 저는 그냥 AWS 들어가서 연결해서 씁니다 ㅋㅋ 귀찬잖아요옹~~
- 근디 님들은 키관리 잘 하셈 ㅡㅡ 저처럼 뻘짓 하지 마시고 ㅡㅡ

### Docker Compose 명령어 오류

- 흠냐링? 서지처럼 했는데 왜 안되는거임??
- 아하! 나는 구버전이어서 `docker-compose up --build -d` 로 써야 하는구나! (← 는 지피티가 해줌)

### 이미지 Pull 실패

- pull access denied for {내 아이디는 비밀❤️}/{이것두 비밀❤️} 이라고 뜨는데 흐음
- 아하! 내가 바보 구나! 이미지 빌드만 하고 푸시를 하면 풀이 될까요?? ㅋ

### Docker 권한 문제

- 이게 .env 나 docker-compose.yml 이나 이것저것 처리하다보니 나갔다가 다시 들어가서 수정하려니까..
- 아예 접근이 막혀버리네? permission denied 어쩌구가 뜨네?(얼씨구?)
- 그럴때는 짧지만 엄청난 ⭐ `sudo` ⭐을 써볼까요 우리? 크킄
    - 근디 웬만하면 안쓰는게 좋음.. 너무 다 관리자 접근으로 가서 건들이면 안될 것 까지 건들일 수도 있어서.. 그만그만..
    - 또는 사용자에 docker 그룹 추가합시다..

### MySQL 접속 실패 (RDS)

- 저는 처음 트러블 슈팅에서 공간 부족으로 RDS 연결을 했사옵니다..
- 근디 이럴수가!! mysql -h … -u … -p 했는데도 비번 쳐도 그냥 멈춰요!
    - 원래는 deny이런 식으로 떠야 정상인데! 이게 무슨!!!
    - 그럴 때는 원인 자체가 비번이 문제가 아닌 것 입니다!!!
    - 문제는??? **EC2 → RDS 접속 자체가 보안 그룹 때문에 차단 인 것입니다!**
    - 저는 3306 포트 열려있네 오케이! 만 하고 넘어가서 이거를 못 봤어요 ㅠㅠ
    - RDS 보안 그룹 인바운드에 EC2 IP 또는 보안 그룹을 추가해 줍시다!!!

### Spring boot RDS 연결 실패

- 봐도 봐도 모르게써서 지피티야 도와줘 >< 했는데 바보 같은 실수를 했네요?
- RDS 를 만들고 ㅋㅋ URL에 그냥 RDS 엔드 포인트를 넣어버린 이런 실수를 한거 있죠??
- 자.. `jdbc:mysql://<rds-endpoint>:3306/{dbname}` 으로 하자!
- 엔드 포인트만 하면 우리 어케 압니까… 그쵸??

---

## ✅ 맨날 까먹는 혜수를 위한 수동 배포 체크리스트

### 1️⃣ EC2 인스턴스에 접속이 되었나?

`ubuntu@ip-xxx-xxx-xxx-xxx:~$`  로 되어 있거나 아니면 aws 에서 ec2 직접 연결하거나!

### 2️⃣ Docker가 설치되어 있나?

```java
docker -v
docker-compose -v
```

### 3️⃣ 컨테이너 실행 중인가?

```java
sudo docker ps
```

🙆container ID 어쩌구… Image ←여기에 내가 원하는 {아이디}/{이미지 이름} 이면 잘 올라간거! 그리고 주요한게 STATUS 가 Up 이여야 실행 중입니다!

🙅아무것도 안 나오면 docker-compose up 이 안되거나 처음부터 해주세요! 컨테이너 설정부터 보기!

### 4️⃣ 스프링 부트 서버 실행 잘되나? (로그 확인)

```java
sudo docker logs -f 자기가 올림 app 이름
```

✅ 로그에 `Started TodoingApplication in ...`이 있으면 성공
❌ 에러 (`Caused by`, `Exception`, `URL must start with 'jdbc'`) → 문제 있음

### 5️⃣ 애플리케이션 포트 바인딩 확인

```java
curl localhost:8080
```

✅ 응답이 오면 애플리케이션 정상 실행

❌ connection refused면 서버가 안 떴거나 죽음 ㅜㅜ

### 6️⃣ .env 또는 docker-compose.yml 설정이 올바른가???

꺼진 불도 다시 보자!

### 7️⃣외부에서 접속이 가능한가??

- 배포 완료 후에는 이것부터 보고 안되면 1부터 다시 확인해보자!

```java
http://<EC2 public IP>:8080
```

- 또한 EC2 보안 그룹에 포트 8080이 ㅕㄹ려 있어야 합니다!!
- 그리고 ! 혹시나 EC2를 껐다가 키면 IP 주소가 바뀌기에… 꼭 우리 Elastic IP 를 씁시다!
- 쓴다면 한 번 할당 받으면 안 바뀌걸랑요 (찡긋!)

이번에는 별로 한게 없군요… 전요.. 배포가 싫어요.. 정말로요

http://15.165.229.144:8080/swagger-ui/index.html#
일단 이거를 배포했는데 너무 자세히 보지는 마십쇼! 대충 만든거여서 껄껄